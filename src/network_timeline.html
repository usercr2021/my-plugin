<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Grafana 风格 网络时序图</title>
<style>
  body {
    font-family: "Inter", "Segoe UI", sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    margin: 0;
    padding: 20px;
  }
  h2 {
    color: #f8fafc;
    text-align: center;
  }
  .chart {
    position: relative;
    border-top: 1px solid #334155;
    border-bottom: 1px solid #334155;
    margin-top: 20px;
    overflow-x: auto;
    white-space: nowrap;
    padding-bottom: 10px;
  }
  .row {
    display: flex;
    align-items: center;
    height: 28px;
    margin: 4px 0;
  }
  .label {
    width: 160px;
    text-align: right;
    padding-right: 12px;
    font-size: 13px;
    color: #94a3b8;
  }
  .bar-container {
    position: relative;
    flex: 1;
    height: 12px;
    background: #1e293b;
    border-radius: 2px;
  }
  .segment {
    position: absolute;
    top: 0;
    height: 100%;
    border-radius: 2px;
  }
  .dns { background: #3b82f6; }
  .tcp { background: #8b5cf6; }
  .request { background: #10b981; }
  .response { background: #f59e0b; }
  .tooltip {
    position: fixed;
    pointer-events: none;
    background: rgba(30, 41, 59, 0.9);
    border: 1px solid #475569;
    border-radius: 4px;
    padding: 6px 10px;
    font-size: 12px;
    color: #f8fafc;
    z-index: 10;
    display: none;
  }
  .timeline {
    position: relative;
    height: 20px;
    margin-top: 10px;
    font-size: 11px;
    color: #64748b;
  }
  .tick {
    position: absolute;
    top: 0;
    height: 8px;
    border-left: 1px solid #475569;
  }
</style>
</head>
<body>
<h2>Grafana 风格 网络时序图</h2>
<div id="timeline" class="timeline"></div>
<div id="chart" class="chart"></div>
<div id="tooltip" class="tooltip"></div>

<script>
const data = [
  { name: "GET /api/user", start: 0, dns: 20, tcp: 30, request: 40, response: 80 },
  { name: "GET /api/order", start: 100, dns: 10, tcp: 20, request: 50, response: 120 },
  { name: "POST /api/login", start: 250, dns: 0, tcp: 15, request: 60, response: 150 },
  { name: "GET /api/products", start: 500, dns: 25, tcp: 25, request: 70, response: 90 },
  { name: "GET /api/cart", start: 700, dns: 15, tcp: 20, request: 60, response: 110 },
];

// === 样式与比例 ===
const chart = document.getElementById("chart");
const tooltip = document.getElementById("tooltip");
const timeline = document.getElementById("timeline");

const totalEnd = Math.max(...data.map(d => d.start + d.dns + d.tcp + d.request + d.response));
const scale = 2; // 每毫秒对应像素，可调整放大倍数
const colors = { dns: "DNS", tcp: "TCP", request: "Request", response: "Response" };

// === 绘制时间刻度 ===
for (let t = 0; t < totalEnd; t += 100) {
  const tick = document.createElement("div");
  tick.className = "tick";
  tick.style.left = `${t * scale}px`;
  tick.innerHTML = `<div style="position:absolute;top:8px;left:2px">${t}ms</div>`;
  timeline.appendChild(tick);
}

// === 绘制每一行 ===
data.forEach((req) => {
  const row = document.createElement("div");
  row.className = "row";

  const label = document.createElement("div");
  label.className = "label";
  label.textContent = req.name;

  const bar = document.createElement("div");
  bar.className = "bar-container";

  let offset = req.start;
  ["dns", "tcp", "request", "response"].forEach((phase) => {
    const w = req[phase];
    if (w > 0) {
      const seg = document.createElement("div");
      seg.className = `segment ${phase}`;
      seg.style.left = `${offset * scale}px`;
      seg.style.width = `${w * scale}px`;
      seg.title = `${phase}: ${w}ms`;
      seg.addEventListener("mousemove", (e) => {
        tooltip.style.display = "block";
        tooltip.style.left = e.pageX + 10 + "px";
        tooltip.style.top = e.pageY + 10 + "px";
        tooltip.innerHTML = `<b>${req.name}</b><br>${colors[phase]}: ${w}ms<br>Start: ${offset}ms`;
      });
      seg.addEventListener("mouseleave", () => (tooltip.style.display = "none"));
      bar.appendChild(seg);
      offset += w;
    }
  });

  row.appendChild(label);
  row.appendChild(bar);
  chart.appendChild(row);
});
</script>
</body>
</html>
